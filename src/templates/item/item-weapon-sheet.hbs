<div class="dh-wrapper">
    <form class="dh-item" autocomplete="off">
        {{log 'weapon' this}}
        <div class="dh-panel dh-grid-col-6">
            <div class="dh-header">
                <div class="dh-header__info">
                    <div class="dh-header__logo dh-header__item-wrapper--span-4">
                        <img class="dh-header__logo-image" src="{{item.img}}" data-edit="img" title="{{item.name}}"/>
                    </div>
                    <div class="dh-header__item-wrapper--span-4">
                        <span class="dh-header__title">Name</span>
                        <input class="dh-header__input" name="name" type="text" value="{{item.name}}"/>
                    </div>
                    <div class="dh-header__item-wrapper--span-2">
                        <span class="dh-header__title">Class</span>
                        <select class="dh-header__select" name="data.class">
                            {{selectOptions (arrayToObject dh.combat.weapon_class) selected=data.class}}
                        </select>
                    </div>
                    <div class="dh-header__item-wrapper--span-2">
                        <span class="dh-header__title">Type</span>
                        <select class="dh-header__select" name="data.type">
                            {{selectOptions (arrayToObject dh.combat.weapon_type) selected=data.type}}
                        </select>
                    </div>
                    <div class="dh-header__item-wrapper">
                        <span class="dh-header__title">Source</span>
                        <input class="dh-header__input" name="data.source" type="text" value="{{data.source}}"/>
                    </div>
                    <div class="dh-header__item-wrapper">
                        <span class="dh-header__title">Weight</span>
                        <input class="dh-header__input" name="data.weight" type="number" data-dtype="Number" value="{{data.weight}}"/>
                    </div>
                    <div class="dh-header__item-wrapper">
                        <span class="dh-header__title">Equipped</span>
                        <input name="data.equipped" type="checkbox" data-dtype="Boolean" {{checked data.equipped}}/>
                    </div>
                    <div class="dh-header__item-wrapper">
                        <span class="dh-header__title">In Backpack</span>
                        <input name="data.backpack.inBackpack" type="checkbox" data-dtype="Boolean" {{checked data.backpack.inBackpack}}/>
                    </div>
                    <div class="dh-header__item-wrapper--span-2">
                        <span class="dh-header__title">Availability</span>
                        <select class="dh-header__select" name="data.availability">
                            {{selectOptions (arrayToObject dh.items.availability) selected=data.availability}}
                        </select>
                    </div>
                    <div class="dh-header__item-wrapper--span-2">
                        <span class="dh-header__title">Craftsmanship</span>
                        <select class="dh-header__select" name="data.craftsmanship">
                            {{selectOptions (arrayToObject dh.items.craftsmanship) selected=data.craftsmanship}}
                        </select>
                    </div>
                </div>
                <div class="dh-navigation" data-group="primary">
                    <label class="dh-navigation__item">
                        <a class="item" data-tab="stats" data-group="primary">stats</a>
                    </label>
                    <label class="dh-navigation__item">
                        <a class="item" data-tab="description" data-group="primary">description</a>
                    </label>
                </div>
                <section class="dh-body">
                    <div class="tab" data-group="primary" data-tab="stats">
                        <div class="dh-panel dh-grid-col-2 dh-grid-row-1">
                            <h1 class="dh-panel__header">Damage</h1>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Roll</span>
                                <input class="dh-field__input" type="text" name="data.damage" value="{{data.damage}}"/>
                            </div>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Type</span>
                                <select class="dh-field__input" name="data.damageType">
                                    {{selectOptions (arrayToObject dh.combat.damage_types) selected=data.damageType}}
                                </select>
                            </div>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Pen</span>
                                <input class="dh-field__input" type="text" name="data.penetration" value="{{data.penetration}}"/>
                            </div>
                        </div>
                        {{#if item.isRanged}}
                        <div class="dh-panel dh-grid-col-2 dh-grid-row-1">
                            <h1 class="dh-panel__header">Ranged Attack</h1>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Range (m)</span>
                                <input class="dh-field__input" type="number" data-dtype="Number" name="data.range" value="{{data.range}}"/>
                            </div>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Single</span>
                                <input class="dh-field__input" type="number" data-dtype="Number" name="data.rateOfFire.single" value="{{data.rateOfFire.single}}"/>
                            </div>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Burst</span>
                                <input class="dh-field__input" type="number" data-dtype="Number" name="data.rateOfFire.burst" value="{{data.rateOfFire.burst}}"/>
                            </div>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Full</span>
                                <input class="dh-field__input" type="number" data-dtype="Number" name="data.rateOfFire.full" value="{{data.rateOfFire.full}}"/>
                            </div>
                        </div>
                        <div class="dh-panel dh-grid-col-2 dh-grid-row-1">
                            <h1 class="dh-panel__header">Ammo</h1>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Reload</span>
                                <input class="dh-field__input" type="text" name="data.reload" value="{{data.reload}}"/>
                            </div>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Current</span>
                                <input class="dh-field__input" type="number" data-dtype="Number" name="data.clip.value" value="{{data.clip.value}}"/>
                            </div>
                            <div class="dh-field__wrapper">
                                <span class="dh-field__header">Max</span>
                                <input class="dh-field__input" type="number" data-dtype="Number" name="data.clip.max" value="{{data.clip.max}}"/>
                            </div>
                            <div>
                                <h1 class="dh-panel__header">Loaded Ammo</h1>
                                <div class="dh-ammotable--border">
                                    <div class="table-row--head">
                                        <div class="table-cell--span2">Name</div>
                                        <div class="table-cell--last"></div>
                                    </div>
                                    {{#each item.items as | embedded |}}
                                        {{#if embedded.isAmmunition}}
                                            <div class="table-row">
                                                <div class="table-cell--settingstoggle">
                                                    <label class="dh-control-button item-edit" data-item-id="{{embedded.id}}">
                                                        <span class="dh-control-button__span material-icons">{{defaultVal icon 'settings'}}</span>
                                                    </label>
                                                </div>
                                                <div class="table-cell--left">
                                                    {{> systems/dark-heresy-2nd/templates/actor/partial/trait-toggle.hbs toggle=(concat 'description_' embedded.id) text=embedded.name}}
                                                </div>
                                                <div class="table-cell--last">
                                                    <label class="dh-control-button item-delete" data-item-id="{{embedded.id}}">
                                                        <span class="dh-control-button__span material-icons">{{defaultVal icon 'delete'}}</span>
                                                    </label>
                                                </div>
                                                <div class="table-cell--description description_{{embedded.id}}" {{hideIfNot (isExpanded (concat 'description_' embedded.id ))}}>
                                                    <span>{{embedded.data.data.description}}</span>
                                                </div>
                                            </div>
                                        {{/if}}
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        {{else}}
                        <div class="dh-panel dh-grid-col-4"></div>
                        {{/if}}

                        <div class="dh-panel dh-grid-col-3">
                            <h1 class="dh-panel__header">Weapon Mods</h1>
                            <div class="dh-weaponmodtable--border">
                                <div class="table-row--head">
                                    <div class="table-cell--span2">Name</div>
                                    <div class="table-cell">Craftsmanship</div>
                                    <div class="table-cell">Installed</div>
                                    <div class="table-cell--last"></div>
                                </div>
                                {{#each item.items as | embedded |}}
                                    {{#if embedded.isWeaponModification}}
                                        <div class="table-row">
                                            <div class="table-cell--settingstoggle">
                                                <label class="dh-control-button item-edit" data-item-id="{{embedded.id}}">
                                                    <span class="dh-control-button__span material-icons">{{defaultVal icon 'settings'}}</span>
                                                </label>
                                            </div>
                                            <div class="table-cell--left">
                                                {{> systems/dark-heresy-2nd/templates/actor/partial/trait-toggle.hbs toggle=(concat 'description_' embedded.id) text=embedded.name}}
                                            </div>
                                            <div class="table-cell">
                                                <span>{{embedded.data.data.craftsmanship}}</span>
                                            </div>
                                            <div class="table-cell">
                                                <span>{{embedded.data.data.equipped}}</span>
                                            </div>
                                            <div class="table-cell--last">
                                                <label class="dh-control-button item-delete" data-item-id="{{embedded.id}}">
                                                    <span class="dh-control-button__span material-icons">{{defaultVal icon 'delete'}}</span>
                                                </label>
                                            </div>
                                            <div class="table-cell--description description_{{embedded.id}}" {{hideIfNot (isExpanded (concat 'description_' embedded.id ))}}>
                                                <span>{{embedded.data.data.description}}</span>
                                            </div>
                                        </div>
                                    {{/if}}
                                {{/each}}
                            </div>
                        </div>
                        <div class="dh-panel dh-grid-col-3">
                            <h1 class="dh-panel__header">Weapon Special</h1>
                            <div class="dh-attackspecialtable--border">
                                <div class="table-row--head">
                                    <div class="table-cell--span2">Name</div>
                                    <div class="table-cell">Level</div>
                                    <div class="table-cell--last"></div>
                                </div>
                                {{#each item.items as | embedded |}}
                                    {{#if embedded.isAttackSpecial}}
                                        <div class="table-row">
                                            <div class="table-cell--settingstoggle">
                                                <label class="dh-control-button item-edit" data-item-id="{{embedded.id}}">
                                                    <span class="dh-control-button__span material-icons">{{defaultVal icon 'settings'}}</span>
                                                </label>
                                            </div>
                                            <div class="table-cell--left">
                                                {{> systems/dark-heresy-2nd/templates/actor/partial/trait-toggle.hbs toggle=(concat 'description_' embedded.id) text=embedded.name}}
                                            </div>
                                            <div class="table-cell">
                                                <span class="display">{{embedded.data.data.equipped}}</span>
                                            </div>
                                            <div class="table-cell--last">
                                                <label class="dh-control-button item-delete" data-item-id="{{embedded.id}}">
                                                    <span class="dh-control-button__span material-icons">{{defaultVal icon 'delete'}}</span>
                                                </label>
                                            </div>
                                            <div class="table-cell--description description_{{embedded.id}}" {{hideIfNot (isExpanded (concat 'description_' embedded.id ))}}>
                                                <span>{{embedded.data.data.description}}</span>
                                            </div>
                                        </div>
                                    {{/if}}
                                {{/each}}
                            </div>
                        </div>
                    </div>
                    <div class="tab" data-group="primary" data-tab="description">
                        <div class="dh-header__info dh-grid-col-6">
                            <div class="dh-header__item-wrapper--text-area">
                                <span class="dh-header__title">Description</span>
                                <textarea class="dh-header__textarea" name="data.description">{{data.description}}</textarea>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </form>
</div>


