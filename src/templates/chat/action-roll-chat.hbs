<div class="dh-wrapper">
    <div class="dh-chat">
        {{#if label}}<h3>{{label}}</h3>{{/if}}
        <div class="dh-roll">
            {{#with rollData}}
                <div>
                    <h1>{{name}}</h1>
                    {{#if action}}<h2>{{action}}</h2>{{/if}}
                    <h2>{{lookup difficulties difficulty}}</h2>
                    <div class="dh-roll__divider"></div>

                    <div class="dh-roll__row dh-roll__row--number">
                        <div class="dh-roll__label">Base</div>
                        <div class="dh-roll__value">{{baseTarget}}</div>
                    </div>
                    {{#each activeModifiers}}
                        <div class="dh-roll__row dh-roll__row--number">
                            <div class="dh-roll__label">Modifier: {{@key}}</div>
                            <div class="dh-roll__value">{{this}}</div>
                        </div>
                    {{/each}}
                    <div class="dh-roll__target">
                        <div class="dh-roll__label">Target</div>
                        <div class="dh-roll__value">{{modifiedTarget}}</div>
                    </div>

                    {{#if ammoUsed}}
                        <div class="dh-roll__row dh-roll__row--number">
                            <div class="dh-roll__label">Ammo Used</div>
                            <div class="dh-roll__value">{{ammoUsed}}</div>
                        </div>
                    {{/if}}

                    {{#each @root.effectOutput as |effect|}}
                        <div class="dh-roll__row--full">
                            <span class='dh-roll__label'>{{effect.name}}</span> - {{effect.effect}}
                        </div>
                    {{/each}}

                    {{#if success}}
                        <div class="dh-roll__row dh-roll__row--number">
                            <div class="dh-roll__label">Degrees of Success</div>
                            <div class="dh-roll__value">{{dos}}</div>
                        </div>
                        <div class="dh-roll__success">
                            <span>Success</span>
                            <span>{{roll.total}}</span>
                        </div>
                    {{else}}
                        <div class="dh-roll__row dh-roll__row--number">
                            <div class="dh-roll__label">Degrees of Failure</div>
                            <div class="dh-roll__value">{{dof}}</div>
                        </div>
                        <div class="dh-roll__fail">
                            <span>Fail</span>
                            <span>{{roll.total}}</span>
                        </div>
                    {{/if}}

                    <div class='dh-roll__controls'>
                        {{#if success}}
                            <button class="dh-control-button roll-control__hide-control" data-toggle="{{@root.id}}">
                                <span class="dh-control-button__span material-icons">bolt</span>
                                <span class="dh-control-button__label">Damage</span>
                            </button>
                        {{else}}
                            <button class="dh-control-button__disabled">
                                <span class="dh-control-button__span material-icons">bolt</span>
                                <span class="dh-control-button__label">Damage</span>
                            </button>
                        {{/if}}
                        <div class="dh-control-button roll-control__refund-ammo" data-roll-id="{{@root.id}}">
                            <span class="dh-control-button__span material-icons">deblur</span>
                            <span class="dh-control-button__label">Refund</span>
                        </div>
                        <div class="dh-control-button roll-control__fate-reroll" data-roll-id="{{@root.id}}">
                            <span class="dh-control-button__span material-icons">casino</span>
                            <span class="dh-control-button__label">Re-roll</span>
                        </div>
                    </div>

                    {{#each @root.effects as |effect|}}
                        <div class="dh-roll__row dh-roll__row--number">
                            <div class="dh-roll__label">{{effect}}</div>
                            <div class="dh-roll__value"></div>
                        </div>
                    {{/each}}

                </div>
            {{/with}}
            {{#if rollData.success}}
                {{#with damageData}}
                    <div id="{{@root.id}}" style="display: none">
                        <div class="dh-roll__divider"></div>
                        {{#each hits as |hit|}}
                            <h2 style='margin-top: .5rem'>Hit {{inc @index}}</h2>
                            <div class="dh-roll__row dh-roll__row--number">
                                <div class="dh-roll__label">Base Damage:</div>
                                <div class="dh-roll__value">{{hit.damageRoll.result}}</div>
                            </div>
                            {{#each modifiers}}
                                <div class="dh-roll__row dh-roll__row--number">
                                    <div class="dh-roll__label">Modifier: {{@key}}</div>
                                    <div class="dh-roll__value">{{this}}</div>
                                </div>
                            {{/each}}
                            <div class="dh-roll__row dh-roll__row--number">
                                <div class="dh-roll__label">Damage Type:</div>
                                <div class="dh-roll__value">{{hit.damageType}}</div>
                            </div>

                            {{#each hit.effects as |effect|}}
                                <div class="dh-roll__row--full">
                                    <span class='dh-roll__label'>{{effect.name}}</span> - {{effect.effect}}
                                </div>
                            {{/each}}

                            <div class="dh-roll__notice">
                                <span>{{hit.totalDamage}} Damage to {{hit.location}}</span>
                            </div>
                            <div class="dh-roll__row dh-roll__row--number">
                                <div class="dh-roll__label">Base Penetration:</div>
                                <div class="dh-roll__value">
                                    {{#if hit.hasPenetrationRoll}}
                                        {{hit.penetrationRoll.result}}
                                    {{else}}
                                        {{hit.penetration}}
                                    {{/if}}
                                </div>
                            </div>
                            {{#each penetrationModifiers}}
                                <div class="dh-roll__row dh-roll__row--number">
                                    <div class="dh-roll__label">Modifier: {{@key}}</div>
                                    <div class="dh-roll__value">{{this}}</div>
                                </div>
                            {{/each}}
                            <div class="dh-roll__notice">
                                <span>{{hit.totalPenetration}} Penetration</span>
                            </div>
                            {{#each righteousFury as |fury|}}
                                <div class="dh-roll__success">
                                    <span>Righteous fury hits for {{fury.total}} critical damage!</span>
                                </div>
                            {{/each}}
                            <div class="dh-roll__divider"></div>
                        {{/each}}
                    </div>
                {{/with}}
            {{/if}}

        </div>
    </div>
</div>
